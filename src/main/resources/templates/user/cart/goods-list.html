<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

	<div class="page_title text_center clear">장바구니</div>

	<div class="cart">
		<div class="table table_head">
			<div class="table_row">
				<div class="col1">
					<label class="check_style">
						<input type="checkbox" id="checkAllGoods" onclick="checkAllGoods(this)" />
						<span></span>
					</label>
				</div>
				<div class="col2">상품명</div>
				<div class="col3">금액</div>
				<div class="col4">선택</div>
			</div>
		</div>

		<!--/* 장바구니 리스트 */-->
		<ul class="table table_body" th:if="${not #lists.isEmpty( goodsList )}">
			<li class="table_row" th:each="row, status : ${goodsList}">
				<div class="col1">
					<label class="check_style">
						<input type="checkbox" name="code" th:value="${row.code}" onclick="checkOneGoods(this)" />
						<span></span>
					</label>
				</div>
				<div class="col2">
					<div class="img_box">
						<img th:src="@{/goods/images/} + ${#temporals.format(row.goods.attachList[0].insertTime, 'yy-MM-dd')} + '/' + ${row.goods.attachList[0].storedName}" th:alt="shoes + ${status.index}" />
					</div>
					<div class="txt_box">
						<p class="name" th:text="${row.goods.name}">상품명</p>
						<p class="option" th:text="|${row.goods.stock.color} / ${row.size}|">색상 / 사이즈</p>
						<p class="quantity" th:text="|수량  : ${row.quantity}|">수량 : 개수</p>
						<a href="javascript: void(0)" class="btn btn_border_black" th:onclick="changeOption([[ ${row.code} ]], [[ ${row.size} ]], [[ ${row.quantity} ]], [[ |${#numbers.formatInteger( row.goods.price * row.quantity, 3, 'COMMA' )}원| ]])">옵션 변경</a>
					</div>
				</div>
				<div class="col3" th:with="normal=${#numbers.formatInteger( (row.goods.price * row.quantity), 3, 'COMMA' )}, sale=${#numbers.formatInteger((T(Math).floor(((row.goods.price * (1 - row.goods.rate / 100.0)) / 10.0)) * 10.0) * row.quantity, 3, 'COMMA')}">
					<del th:if="${row.goods.status == T(com.dy.common.Const.Status).D}" th:text="${normal}"></del>
					<br th:if="${row.goods.status == T(com.dy.common.Const.Status).D}" />
					<span name="price" th:if="${row.goods.status == T(com.dy.common.Const.Status).D}" class="orange" th:text="${sale}" th:attr="data-price=${#numbers.formatInteger((T(Math).floor(((row.goods.price * (1 - row.goods.rate / 100.0)) / 10.0)) * 10.0) * row.quantity, 3)}">가격</span>
					<span name="price" th:unless="${row.goods.status == T(com.dy.common.Const.Status).D}" class="orange" th:text="${normal}" th:attr="data-price=${row.goods.price * row.quantity}">가격</span>
				</div>
				<div class="col4">
					<button type="button" class="btn btn_black" th:onclick="goPurchase([[ ${row.code} ]])">주문하기</button>
					<button type="button" class="btn btn_gray" th:onclick="deleteGoods([[ ${row.code} ]], [[ ${row.goods.name} ]])">삭제하기</button>
				</div>
			</li>
		</ul>

		<div class="sm_btn_wrap">
			<button type="button" class="btn btn_gray" onclick="deleteAllGoods()">전체상품 삭제</button>
			<button type="button" class="btn btn_gray" onclick="deleteCheckedGoods()">선택상품 삭제</button>
		</div>
	</div>

	<div class="total_price">
		<div class="price">
			<p id="totalGoodsAmount">
				<span>상품 금액</span>
				<strong></strong>
			</p>
			<p id="deliveryCharge">
				<span>배송비</span>
				<strong></strong>
			</p>
			<p id="paymentAmount" class="last">
				<span>총 결제 금액</span>
				<strong class="orange"></strong>
			</p>
		</div>

		<div class="btn_wrap text_center clear">
			<button type="button" class="btn btn_orange" th:onclick="goMultiplePurchase([[ ${goodsList} ]])">주문하기</button>
			<a th:href="@{/goods/list}" class="btn btn_gray">쇼핑 계속하기</a>
		</div>
	</div>

	<th:block layout:fragment="script">
		<script th:inline="javascript">
		/* <![CDATA[ */

			$(function() {
				var totalAmount = 0;
				var prices = document.getElementsByName("price");
				prices.forEach(function(obj, idx) {
					totalAmount += parseInt(obj.dataset.price);
				});

				/*[- 상품 금액 -]*/
				$("#totalGoodsAmount > strong").text(makeCommas(totalAmount + "원"));
				/*[- 배송비 -]*/
				var deliveryCharge = totalAmount >= 50000 ? "무료" : "2,500원";
				$("#deliveryCharge > strong").text(deliveryCharge);
				/*[- 총 결제 금액 -]*/
				var paymentAmount = totalAmount >= 50000 ? totalAmount + 0 : totalAmount + 2500;
				$("#paymentAmount > strong").text(makeCommas(paymentAmount));
			});

		/* ]]> */
		</script>
	</th:block>

</html>